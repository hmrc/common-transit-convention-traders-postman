{
	"info": {
		"_postman_id": "40e41881-7c27-492b-b329-2b7e5ba27fe7",
		"name": "02_Bearer Token CTC API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth_Dev_With_Enrolment",
			"item": [
				{
					"name": "01-POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									" "
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.development.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "{{eori}}",
									"type": "text"
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth_Dev_W/o_Enrolment",
			"item": [
				{
					"name": "01- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.development.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "9999999901",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token1\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth_QA_With_Enrolment",
			"item": [
				{
					"name": "01- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.qa.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "{{eori}}",
									"type": "text"
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"setTimeout(function(){}, [200]);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Auth_QA_W/o_Enrolment",
			"item": [
				{
					"name": "01- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.qa.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "9999999911",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token1\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"setTimeout(function(){}, [200]);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Auth_With_Enrolment_ET",
			"item": [
				{
					"name": "01-POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://test-www.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "{{eori}}",
									"type": "text"
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "4lGf7l7FoyFQSdmkwhBros2HYqKs",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "0b412f77-e1b7-4ae0-9dca-2c9909999d7a",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-api.service.hmrc.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"{{env}}-api",
								"service",
								"hmrc",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Auth_W/0_Enrolment_ET",
			"item": [
				{
					"name": "01- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var path;",
									"",
									"links = $('a'); //jquery get all hyperlinks",
									"  $(links).each(function(i, link){",
									"    if(i==5)",
									"    {",
									"      path = $(link).attr('href');",
									"      var auth_id = path.split(\"=\")[1];",
									"      pm.environment.set(\"auth_id\",auth_id)",
									"   ",
									"    }",
									"  })",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://test-www.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "9999999911",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- GET Grant Auth 303",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"pm.environment.set(\"csrfToken\",csrfToken);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "03- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-www.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"{{env}}-www",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "04- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token1\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "4lGf7l7FoyFQSdmkwhBros2HYqKs",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "0b412f77-e1b7-4ae0-9dca-2c9909999d7a",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://{{env}}-api.service.hmrc.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"{{env}}-api",
								"service",
								"hmrc",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Auth_Staging_With_Enrolment",
			"item": [
				{
					"name": "01-GET Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var location = $(\"[class='form-field']\").html()",
									"console.log(location)",
									"var grant_scope= (location.split(\"=\")[1]).split(\"\\\"\")[1]",
									"pm.environment.set(\"grant_scope\",grant_scope);",
									"",
									"var auth_id = (location.split(\"=\")[2]).split(\"\\\" class\")[0];",
									"pm.environment.set(\"auth_id\",auth_id);",
									"console.log(\"Auth Id is \"+auth_id)"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.staging.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text"
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "{{eori}}",
									"type": "text"
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "03- GET Grant Authority 2nd Redirect",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/gg/sign-in?continue=%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}&origin=oauth-frontend",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"gg",
								"sign-in"
							],
							"query": [
								{
									"key": "continue",
									"value": "%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}"
								},
								{
									"key": "origin",
									"value": "oauth-frontend"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "04- GET Grant Authority Redirect2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/bas-gateway/sign-in?continue_url=%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}&origin=oauth-frontend",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"bas-gateway",
								"sign-in"
							],
							"query": [
								{
									"key": "continue_url",
									"value": "%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}"
								},
								{
									"key": "origin",
									"value": "oauth-frontend"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "05- GET Grant Auth 200",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"",
									"pm.environment.set(\"csrfToken\",csrfToken);",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "06- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "07- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Auth_Staging_W/o_Enrolment",
			"item": [
				{
					"name": "01- GET Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "02- POST Auth Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"const $ = cheerio.load(responseBody);",
									"var location = $(\"[class='form-field']\").html()",
									"var auth_id = (location.split(\"=\")[2]).split(\"\\\" class\")[0];",
									"pm.environment.set(\"auth_id\",auth_id);",
									"console.log(\"Auth Id is \"+auth_id)"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "",
								"value": "",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "redirectionUrl",
									"value": "https://www.staging.tax.service.gov.uk/oauth/authorize?client_id={{client_Id}}&redirect_uri=urn:ietf:wg:oauth:2.0:oob&scope=common-transit-convention-traders common-transit-convention-traders-test-support&response_type=code",
									"type": "text"
								},
								{
									"key": "credentialStrength",
									"value": "strong",
									"type": "text"
								},
								{
									"key": "confidenceLevel",
									"value": "200",
									"type": "text"
								},
								{
									"key": "nino",
									"value": "AA000000A",
									"type": "text"
								},
								{
									"key": "affinityGroup",
									"value": "Individual",
									"type": "text"
								},
								{
									"key": "authorityId",
									"value": "abcd",
									"type": "text"
								},
								{
									"key": "enrolment[0].name",
									"value": "HMCE-NCTS-ORG",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].name",
									"value": "VATRegNoTURN",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].taxIdentifier[0].value",
									"value": "9999999901",
									"type": "text",
									"disabled": true
								},
								{
									"key": "enrolment[0].state",
									"value": "Activated",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/auth-login-stub/gg-sign-in",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"auth-login-stub",
								"gg-sign-in"
							]
						}
					},
					"response": []
				},
				{
					"name": "03- GET Grant Authority 2nd Redirect",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/gg/sign-in?continue=%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}&origin=oauth-frontend",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"gg",
								"sign-in"
							],
							"query": [
								{
									"key": "continue",
									"value": "%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}"
								},
								{
									"key": "origin",
									"value": "oauth-frontend"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "04- GET Grant Authority Redirect2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/bas-gateway/sign-in?continue_url=%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}&origin=oauth-frontend",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"bas-gateway",
								"sign-in"
							],
							"query": [
								{
									"key": "continue_url",
									"value": "%2Foauth%2Fgrantscope%3Fauth_id%3D{{auth_id}}"
								},
								{
									"key": "origin",
									"value": "oauth-frontend"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "05- GET Grant Auth 200",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var csrfToken = responseBody('[name=\"csrfToken\"]').val();",
									"",
									"pm.environment.set(\"csrfToken\",csrfToken);",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope?auth_id={{auth_id}}",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							],
							"query": [
								{
									"key": "auth_id",
									"value": "{{auth_id}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "06- POST Submit Grant Authority",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var responseBody = cheerio.load(pm.response.text());",
									"var code = (responseBody('title').text()).split(\"=\")[1]",
									"",
									"pm.environment.set(\"code\",code);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "csrfToken",
									"value": "{{csrfToken}}",
									"type": "text"
								},
								{
									"key": "auth_id",
									"value": "{{auth_id}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://www.{{env}}.tax.service.gov.uk/oauth/grantscope",
							"protocol": "https",
							"host": [
								"www",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"grantscope"
							]
						}
					},
					"response": []
				},
				{
					"name": "07- Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var accessToken = JSON.parse(responseBody);",
									"pm.environment.set(\"access_token1\", accessToken.access_token);",
									"",
									"pm.environment.unset(\"auth_id\")",
									"pm.environment.unset(\"csrfToken\")",
									"pm.environment.unset(\"grant_scope\")",
									"pm.environment.unset(\"code\")",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "code",
									"value": "{{code}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_Id}}",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "urn:ietf:wg:oauth:2.0:oob",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://api.{{env}}.tax.service.gov.uk/oauth/token",
							"protocol": "https",
							"host": [
								"api",
								"{{env}}",
								"tax",
								"service",
								"gov",
								"uk"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"setTimeout(function(){}, [200]);"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}